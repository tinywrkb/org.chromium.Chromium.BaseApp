id: org.chromium.Chromium.BaseApp
branch: '21.08'
runtime: org.freedesktop.Platform
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
separate-locales: false
modules:
  - name: libsecret
    buildsystem: meson
    config-opts:
      - -Dmanpage=false
      - -Dvapi=false
      - -Dgtk_doc=false
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share/gir-1.0
      - /share/man
    sources:
      - type: archive
        url: https://download.gnome.org/sources/libsecret/0.19/libsecret-0.19.1.tar.xz
        sha256: 8583e10179456ae2c83075d95455f156dc08db6278b32bf4bd61819335a30e3a

  - name: gtk3-cups-backend
    buildsystem: meson
    make-args: [modules/printbackends/libprintbackend-cups.so]
    no-make-install: true
    post-install:
      - install -Dm 755 modules/printbackends/libprintbackend-cups.so -t /app/lib/gtkmodules/3.0.0/printbackends/
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gtk+/3.24/gtk+-3.24.33.tar.xz
        sha256: 588b06522e25d1579e989b6f9d8a1bdbf2fe13cde01a04e904ff346a225e7801
        x-checker-data:
          type: gnome
          name: gtk+
          stable-only: true
          versions:
            <: '3.89'
      # From https://gitlab.gnome.org/GNOME/gnome-build-meta/-/blob/master/files/gtk3-werror.patch
      - type: patch
        path: gtk3-werror.patch

  - name: gtk-settings
    buildsystem: simple
    build-commands:
      - install -Dm 644 gtk-settings.ini /app/etc/xdg/gtk-3.0/settings.ini
      - install -Dm 644 gtk-settings.ini /app/etc/xdg/gtk-4.0/settings.ini
    sources:
      - type: file
        path: gtk-settings.ini

  - name: gtk4
    buildsystem: meson
    builddir: true
    build-options:
      cflags: -DG_DISABLE_CAST_CHECKS
    build-commands:
      # gtk4-update-icon-cache call in build-aux/meson/post-install.py needs an existing, writable hicolor theme folder
      - install -dm755 ${FLATPAK_DEST}/share/icons/hicolor
    config-opts:
      - -Dx11-backend=true
      - -Dwayland-backend=true
      - -Dbroadway-backend=false
      - -Dmedia-ffmpeg=disabled
      - -Dmedia-gstreamer=disabled
      - -Dprint-cups=enabled
      - -Dcloudproviders=disabled
      - -Dsysprof=disabled
      - -Dtracker=disabled
      - -Dcolord=disabled
      - -Dgtk_doc=false
      - -Dman-pages=false
      - -Ddebug=false
      - -Dintrospection=disabled
      - -Ddemos=false
      - -Dbuild-examples=false
      - -Dbuild-tests=false
    sources:
      - type: archive
        url: https://download.gnome.org/sources/gtk/4.6/gtk-4.6.1.tar.xz
        sha256: d85508d21cbbcd63d568a7862af5ecd63b978d7d5799cbe404c91d2389d0ec5f
        x-checker-data:
          type: gnome
          name: gtk
          stable-only: true
      - type: shell
        commands:
          - sed '/^printbackends_subdir/ s/gtk-4\.0/gtkmodules/' -i modules/printbackends/meson.build
    cleanup:
      - /bin
      - /include
      - /lib/pkgconfig
      - /share/gettext
      - /share/gtk-4.0/gtk4builder.rng
      - /share/gtk-4.0/valgrind
      - /share/icons
    modules:
      - name: graphene
        buildsystem: meson
        config-opts:
          - -Dintrospection=disabled
          - -Dtests=false
          - -Dinstalled_tests=false
        sources:
          - type: archive
            url: https://github.com/ebassi/graphene/releases/download/1.10.6/graphene-1.10.6.tar.xz
            sha256: 80ae57723e4608e6875626a88aaa6f56dd25df75024bd16e9d77e718c3560b25
            x-checker-data:
              type: anitya
              project-id: 12758
              stable-only: true
              url-template: https://github.com/ebassi/graphene/releases/download/$version/graphene-$version.tar.xz
        cleanup:
          - /include
          - /lib/graphene-1.0
          - /lib/pkgconfig
      - name: pango
        config-opts:
          - --buildtype=release
          - -Dgtk_doc=false
          - -Dintrospection=disabled
        buildsystem: meson
        sources:
          - type: archive
            url: https://download.gnome.org/sources/pango/1.50/pango-1.50.5.tar.xz
            sha256: 6d136872da6207fe88c5cd2c95c36bcaf4ed29402b854663a86cd7efe99b0cf5
            x-checker-data:
              type: gnome
              name: pango
              stable-only: true
        cleanup:
          - /bin
          - /include
          - /lib/pkgconfig
          - /share/man

  - name: fcitx5-gtk
    buildsystem: cmake-ninja
    config-opts:
      - -DGTK3_IM_MODULEDIR=${FLATPAK_DEST}/lib/gtkmodules/3.0.0/immodules
      - -DGTK4_IM_MODULEDIR=${FLATPAK_DEST}/lib/gtkmodules/4.0.0/immodules
      - -DENABLE_GIR=OFF
      - -DENABLE_GTK2_IM_MODULE=OFF
      - -DENABLE_GTK3_IM_MODULE=OFF
      - -DENABLE_GTK4_IM_MODULE=ON
      - -DENABLE_SNOOPER=ON
    sources:
      - type: archive
        url: https://github.com/fcitx/fcitx5-gtk/archive/5.0.13/fcitx5-gtk-5.0.13.tar.gz
        sha256: 40912698baca050bf06b6f5ce55a91cc14d852519aacb39b293c9f542a708250
        x-checker-data:
          type: anitya
          project-id: 138235
          stable-only: true
          url-template: https://github.com/fcitx/fcitx5-gtk/archive/$version/fcitx5-gtk-$version.tar.gz
    cleanup:
      - /include
      - /lib/cmake
      - /lib/pkgconfig
    modules:
      - name: extra-cmake-modules
        buildsystem: cmake
        sources:
          - type: archive
            url: https://download.kde.org/stable/frameworks/5.89/extra-cmake-modules-5.89.0.tar.xz
            sha256: 3dd7229a225923b8570a333ee6e4a07b0f5f700ea9538fdeb22cc3cbba69f02f
        cleanup:
          - '*'

  - name: ibus-gtk
    config-opts:
      - --disable-tests
      - --disable-gtk2
      - --disable-gtk3
      - --enable-gtk4
      - --disable-xim
      - --disable-wayland
      - --disable-appindicator
      - --disable-introspection
      - --disable-gtk-doc
      - --disable-memconf
      - --disable-dconf
      - --disable-python2
      - --disable-setup
      - --with-python=python3
      - --disable-python-library
      - --enable-key-snooper
      - --enable-surrounding-text
      - --disable-ui
      - --disable-engine
      - --disable-emoji-dict
      - --disable-unicode-dict
      - --disable-vala
      - --with-gtk3-im-module-dir=${FLATPAK_DEST}/lib/gtkmodules/3.0.0/immodules
      - --with-gtk4-im-module-dir=${FLATPAK_DEST}/lib/gtkmodules/4.0.0/immodules
    sources:
      - type: archive
        url: https://github.com/ibus/ibus/releases/download/1.5.25/ibus-1.5.25.tar.gz
        sha256: dea4f663c485267cc3313e40a0bc89b977c397e19644f8ab41df0e6eaec34330
        x-checker-data:
          type: anitya
          project-id: 1352
          stable-only: true
          url-template: https://github.com/ibus/ibus/releases/download/$version/ibus-$version.tar.gz
      - type: shell
        commands:
          - sed '/^AM_CONDITIONAL.*ENABLE_DAEMON/ s/true/false/' -i configure.ac
          - sed '/^SUBDIRS/,/$(NULL)/ s/data\|docs\|ibus\|portal\|tools\|util//' -i Makefile.am
    cleanup:
      - /include
      - /lib/pkgconfig
      - /share
      - '*.la'

  - name: krb5
    subdir: src
    config-opts:
      - --disable-static
      - --disable-rpath
    sources:
      - type: archive
        url: https://github.com/krb5/krb5/archive/refs/tags/krb5-1.19.2-final.tar.gz
        sha256: 84a1dc720e436926359808cc62543946897bf797aba3588b373165f127532cd8
        x-checker-data:
          type: anitya
          project-id: 13287
          stable-only: true
          url-template: https://github.com/krb5/krb5/archive/refs/tags/krb5-$version.tar.gz
      - type: shell
        dest: src
        commands:
          - autoreconf -si

  - name: krb5-config
    buildsystem: simple
    build-commands:
      - install -Dm 644 krb5.conf -t /app/etc
    sources:
      - type: file
        path: krb5.conf

  - name: flextop
    buildsystem: meson
    sources:
      - type: git
        url: https://github.com/refi64/flextop
        tag: v2021.07.1
        commit: 9f66dac84388f520ecab5ac4fa60df6343b7db5b
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$

  - name: cobalt
    buildsystem: meson
    sources:
      - type: git
        url: https://github.com/refi64/cobalt
        tag: v2021.11.1
        commit: 8a49246a97fcb989b370c20b204324862d79541f
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
